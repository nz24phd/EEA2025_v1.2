# case5_feeder_py.py (最终的、参数修正版)
# 修正：将基础负荷单位从错误的10MW改为更合理的0.01MW (10kW)
# 修正：将线路阻抗调整为更贴近实际的值，以便观察到更明显的电压降

import numpy as np

def case5_feeder_data():
    """A simple 5-bus radial feeder for PyPower, with realistic parameters."""
    ppc = {
        "version": '2',
        "baseMVA": 100.0,
        
        "bus": np.array([
            # bus_i, type, Pd(MW), Qd(MVAr), ...
            [1, 3, 0,    0,      0, 0, 1, 1.0, 0, 0.4, 1, 1.1, 0.9],
            # 修正：将10MW/5MVAr的基础负荷改为0.01MW/0.005MVAr (即10kW/5kVAr)
            [2, 1, 0.01, 0.005,  0, 0, 1, 1.0, 0, 0.4, 1, 1.1, 0.9],
            [3, 1, 0.01, 0.005,  0, 0, 1, 1.0, 0, 0.4, 1, 1.1, 0.9],
            [4, 1, 0.01, 0.005,  0, 0, 1, 1.0, 0, 0.4, 1, 1.1, 0.9],
            [5, 1, 0.01, 0.005,  0, 0, 1, 1.0, 0, 0.4, 1, 1.1, 0.9],
        ]),
        
        "gen": np.array([
            [1, 0, 0, 999, -999, 1.0, 100, 1, 999, -999],
        ]),
        
        "branch": np.array([
            # fbus, tbus, r(p.u.), x(p.u.), ...
            # 修正：将线路阻抗调大一些，让电压变化更明显
            [1, 2, 0.02, 0.01, 0, 999, 999, 999, 0, 0, 1, -360, 360],
            [2, 3, 0.02, 0.01, 0, 999, 999, 999, 0, 0, 1, -360, 360],
            [3, 4, 0.02, 0.01, 0, 999, 999, 999, 0, 0, 1, -360, 360],
            [4, 5, 0.02, 0.01, 0, 999, 999, 999, 0, 0, 1, -360, 360],
        ]),
    }
    return ppc